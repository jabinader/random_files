import { BehaviorSubject, of } from 'rxjs';
import { SirenDataSource } from './siren-datasource';
import { deepClone } from '../utils/helpers';
import { DefaultFilterValue } from '../enums/siren-table-filter-value.enum';
export class SirenBeDataSource extends SirenDataSource {
    constructor(service) {
        super();
        this.service = service;
        this.dataSubject = new BehaviorSubject([]);
        this.count = 0;
    }
    connect() {
        return this.dataSubject.asObservable();
    }
    disconnect() {
        this.dataSubject.complete();
    }
    getSize() {
        return this.params?.size ?? DefaultFilterValue.DEFAULT_PAGE_SIZE;
    }
    getPage() {
        return this.params?.page ?? DefaultFilterValue.DEFAULT_PAGE;
    }
    getKeyword() {
        return this.params?.keyword ?? DefaultFilterValue.DEFAULT_KEYWORD;
    }
    getSortColumn() {
        return this.params?.sortColumn ?? DefaultFilterValue.DEFAULT_SORT_COLUMN;
    }
    getSortDirection() {
        return this.params?.sortDirection ?? DefaultFilterValue.DEFAULT_SORT_DIRECTION;
    }
    getCount() {
        return this.count;
    }
    isAllRowsSelected() {
        return this.data?.find(row => row.isSelected === false || row.isSelected === undefined) === undefined;
    }
    /**
     * Loads the data fetched from the backend into Siren data table.
     * It is invoked on each pagination and sorting change event.
     * @param params an object that can be a filter's field to fetch data based on speicific condition, usually it represents the request header
     * @param showLoader useful while using spinner interceptor to show/hide the spinner.
     */
    loadData(params, showLoader = true) {
        this.params = params;
        this.fetchData(this.params, showLoader);
    }
    fetchData(params, showLoader = true) {
        this.service.fetchData(params, showLoader)
            .subscribe(data => {
            const response = this.service.handleData(data?.body);
            this.setCountAndData(response);
            this.sendDataToTable();
        }, () => {
            this.resetData();
            return of();
        });
    }
    /**
     * Loads last data in the table's.
     */
    resetData() {
        this.dataSubject.next(deepClone(this.data));
    }
    filter(keywords) {
        this.params.keyword = keywords;
        this.params.page = DefaultFilterValue.DEFAULT_PAGE;
        this.service.filterDataTable(this.params, this.data).subscribe(data => {
            const response = this.service.handleData(data?.body);
            this.setCountAndData(response);
            this.sendDataToTable();
        }, () => {
            this.resetData();
            return of();
        });
    }
    setCountAndData(response) {
        this.count = response.count;
        this.data = response.list;
        this.checkSelectedRows();
    }
    sendDataToTable() {
        this.dataSubject.next(this.data);
    }
    selectAllRows() {
        this.data.forEach(row => {
            this.selectRow(row);
        });
    }
    deselectAllRows(onlyPaginated = true) {
        this.data.forEach(row => this.deselectRow(row));
        if (!onlyPaginated) {
            this.selectedRows.clear();
        }
    }
    /**
     * Sets current page, size and invoke fetchData accordingly
     * @param data a model that contain current page, size
     */
    updatePaginationParams(data) {
        this.params.page = data.page;
        this.params.size = data.size;
        this.fetchData(this.params);
    }
    /**
     * Sets sortColumn and sortDirection and invoke fetchData accordingly
     * @param data a model that contain sortColumn and sortDirection
     */
    updateSortParams(data) {
        this.params.sortColumn = data.sortColumn;
        this.params.sortDirection = data.sortDirection;
        this.fetchData(this.params);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lyZW4tYmUtZGF0YXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3RhYmxlL3NyYy9saWIvdGFibGUvZGF0YS1zb3VyY2Uvc2lyZW4tYmUtZGF0YXNvdXJjZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZUFBZSxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUd2RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFckQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRTdDLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQzVFLE1BQU0sT0FBTyxpQkFBcUIsU0FBUSxlQUFlO0lBS3hELFlBQW1CLE9BQTZCO1FBQy9DLEtBQUssRUFBRSxDQUFDO1FBRFUsWUFBTyxHQUFQLE9BQU8sQ0FBc0I7UUFIL0IsZ0JBQVcsR0FBRyxJQUFJLGVBQWUsQ0FBbUIsRUFBRSxDQUFDLENBQUM7UUFFakUsVUFBSyxHQUFXLENBQUMsQ0FBQztJQUcxQixDQUFDO0lBQ0QsT0FBTztRQUNOLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN4QyxDQUFDO0lBRUQsVUFBVTtRQUNULElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUNNLE9BQU87UUFDYixPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxJQUFJLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDO0lBQ2xFLENBQUM7SUFDTSxPQUFPO1FBQ2IsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksSUFBSSxrQkFBa0IsQ0FBQyxZQUFZLENBQUM7SUFDN0QsQ0FBQztJQUNNLFVBQVU7UUFDaEIsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLE9BQU8sSUFBSSxrQkFBa0Is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RU0sYUFBYTtRQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUN2QixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVNLGVBQWUsQ0FBQyxhQUFhLEdBQUcsSUFBSTtRQUMxQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUMvQyxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ25CLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDMUI7SUFDRixDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksc0JBQXNCLENBQUMsSUFBMkI7UUFDeEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM3QixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQzdCLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFDRDs7O09BR0c7SUFDSSxnQkFBZ0IsQ0FBQyxJQUEyQjtRQUNsRCxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDL0MsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDN0IsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgU2lyZW5UYWJsZVNlcnZpY2UgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3NpcmVuLWRhdGEtc2VydmljZSc7XG5pbXBvcnQgeyBTaXJlblRhYmxlRmlsdGVyTW9kZWwgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3NpcmVuLXRhYmxlLWZpbHRlci5tb2RlbCc7XG5pbXBvcnQgeyBTaXJlbkRhdGFTb3VyY2UgfSBmcm9tICcuL3NpcmVuLWRhdGFzb3VyY2UnO1xuaW1wb3J0IHsgU2lyZW5UYWJsZURhdGEsIFNpcmVuVGFibGVTb3VyY2UgfSBmcm9tICcuLi9pbnRlcmZhY2VzL2RhdGEtdGFibGUubW9kZWwnO1xuaW1wb3J0IHsgZGVlcENsb25lIH0gZnJvbSAnLi4vdXRpbHMvaGVscGVycyc7XG5pbXBvcnQgeyBTb3J0RGlyZWN0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc29ydCc7XG5pbXBvcnQgeyBEZWZhdWx0RmlsdGVyVmFsdWUgfSBmcm9tICcuLi9lbnVtcy9zaXJlbi10YWJsZS1maWx0ZXItdmFsdWUuZW51bSc7XG5leHBvcnQgY2xhc3MgU2lyZW5CZURhdGFTb3VyY2U8VD4gZXh0ZW5kcyBTaXJlbkRhdGFTb3VyY2V7XG5cblx0cHJpdmF0ZSByZWFkb25seSBkYXRhU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8U2lyZW5UYWJsZURhdGFbXT4oW10pO1xuXHRwcml2YXRlIHBhcmFtczogU2lyZW5UYWJsZUZpbHRlck1vZGVsO1xuXHRwcml2YXRlIGNvdW50OiBudW1iZXIgPSAwO1xuXHRjb25zdHJ1Y3RvcihwdWJsaWMgc2VydmljZTogU2lyZW5UYWJsZVNlcnZpY2U8VD4pIHtcblx0XHRzdXBlcigpO1xuXHR9XG5cdGNvbm5lY3QoKTogT2JzZXJ2YWJsZTxTaXJlblRhYmxlRGF0YVtdPiB7XG5cdFx0cmV0dXJuIHRoaXMuZGF0YVN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG5cdH1cblxuXHRkaXNjb25uZWN0KCk6IHZvaWQge1xuXHRcdHRoaXMuZGF0YVN1YmplY3QuY29tcGxldGUoKTtcblx0fVxuXHRwdWJsaWMgZ2V0U2l6ZSgpOiBudW1iZXIge1xuXHRcdHJldHVybiB0aGlzLnBhcmFtcz8uc2l6ZSA/PyBEZWZhdWx0RmlsdGVyVmFsdWUuREVGQVVMVF9QQUdFX1NJWkU7XG5cdH1cblx0cHVibGljIGdldFBhZ2UoKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gdGhpcy5wYXJhbXM/LnBhZ2UgPz8gRGVmYXVsdEZpbHRlclZhbHVlLkRFRkFVTFRfUEFHRTtcblx0fVxuXHRwdWJsaWMgZ2V0S2V5d29yZCgpOiBzdHJpbmcge1xuXHRcdHJldHVybiB0aGlzLnBhcmFtcz8ua2V5d29yZCA/PyBEZWZhdWx0RmlsdGVyVmFsdWUuREVGQVVMVF9LRVlXT1JEO1xuXHR9XG5cdHB1YmxpYyBnZXRTb3J0Q29sdW1uKCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIHRoaXMucGFyYW1zPy5zb3J0Q29sdW1uID8/IERlZmF1bHRGaWx0ZXJWYWx1ZS5ERUZBVUxUX1NPUlRfQ09MVU1OO1xuXHR9XG5cdHB1YmxpYyBnZXRTb3J0RGlyZWN0aW9uKCk6IFNvcnREaXJlY3Rpb24ge1xuXHRcdHJldHVybiB0aGlzLnBhcmFtcz8uc29ydERpcmVjdGlvbiA/PyBEZWZhdWx0RmlsdGVyVmFsdWUuREVGQVVMVF9TT1JUX0RJUkVDVElPTjtcblx0fVxuXG5cdHB1YmxpYyBnZXRDb3VudCgpOiBudW1iZXIge1xuXHRcdHJldHVybiB0aGlzLmNvdW50O1xuXHR9XG5cblx0cHVibGljIGlzQWxsUm93c1NlbGVjdGVkKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLmRhdGE/LmZpbmQocm93ID0+IHJvdy5pc1NlbGVjdGVkID09PSBmYWxzZSB8fCByb3cuaXNTZWxlY3RlZCA9PT0gdW5kZWZpbmVkKSA9PT0gdW5kZWZpbmVkO1xuXHR9XG5cdC8qKlxuXHQgKiBMb2FkcyB0aGUgZGF0YSBmZXRjaGVkIGZyb20gdGhlIGJhY2tlbmQgaW50byBTaXJlbiBkYXRhIHRhYmxlLlxuXHQgKiBJdCBpcyBpbnZva2VkIG9uIGVhY2ggcGFnaW5hdGlvbiBhbmQgc29ydGluZyBjaGFuZ2UgZXZlbnQuXG5cdCAqIEBwYXJhbSBwYXJhbXMgYW4gb2JqZWN0IHRoYXQgY2FuIGJlIGEgZmlsdGVyJ3MgZmllbGQgdG8gZmV0Y2ggZGF0YSBiYXNlZCBvbiBzcGVpY2lmaWMgY29uZGl0aW9uLCB1c3VhbGx5IGl0IHJlcHJlc2VudHMgdGhlIHJlcXVlc3QgaGVhZGVyXG5cdCAqIEBwYXJhbSBzaG93TG9hZGVyIHVzZWZ1bCB3aGlsZSB1c2luZyBzcGlubmVyIGludGVyY2VwdG9yIHRvIHNob3cvaGlkZSB0aGUgc3Bpbm5lci5cblx0ICovXG5cdHB1YmxpYyBsb2FkRGF0YShwYXJhbXM6IFNpcmVuVGFibGVGaWx0ZXJNb2RlbCwgc2hvd0xvYWRlciA9IHRydWUpOiB2b2lkIHtcblx0XHR0aGlzLnBhcmFtcyA9IHBhcmFtcztcblx0XHR0aGlzLmZldGNoRGF0YSh0aGlzLnBhcmFtcyxzaG93TG9hZGVyKTtcblx0fVxuXG5cdHByaXZhdGUgZmV0Y2hEYXRhKHBhcmFtczogU2lyZW5UYWJsZUZpbHRlck1vZGVsLCBzaG93TG9hZGVyID0gdHJ1ZSk6IHZvaWQge1xuXHRcdHRoaXMuc2VydmljZS5mZXRjaERhdGEocGFyYW1zLCBzaG93TG9hZGVyKVxuXHRcdFx0LnN1YnNjcmliZSggZGF0YSA9PiB7XG5cdFx0XHRcdGNvbnN0IHJlc3BvbnNlID0gdGhpcy5zZXJ2aWNlLmhhbmRsZURhdGEoZGF0YT8uYm9keSk7XG5cdFx0XHRcdHRoaXMuc2V0Q291bnRBbmREYXRhKHJlc3BvbnNlKTtcblx0XHRcdFx0dGhpcy5zZW5kRGF0YVRvVGFibGUoKTtcblx0XHRcdH0sKCkgPT4ge1xuXHRcdFx0XHR0aGlzLnJlc2V0RGF0YSgpO1xuXHRcdFx0XHRyZXR1cm4gb2YoKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIExvYWRzIGxhc3QgZGF0YSBpbiB0aGUgdGFibGUncy5cblx0ICovXG5cdHB1YmxpYyByZXNldERhdGEoKTogdm9pZCB7XG5cdFx0dGhpcy5kYXRhU3ViamVjdC5uZXh0KGRlZXBDbG9uZSh0aGlzLmRhdGEpKTtcblx0fVxuXG5cdHB1YmxpYyBmaWx0ZXIoa2V5d29yZHM6IHN0cmluZyk6IHZvaWQge1xuXHRcdHRoaXMucGFyYW1zLmtleXdvcmQgPSBrZXl3b3Jkcztcblx0XHR0aGlzLnBhcmFtcy5wYWdlID0gRGVmYXVsdEZpbHRlclZhbHVlLkRFRkFVTFRfUEFHRTtcblx0XHR0aGlzLnNlcnZpY2UuZmlsdGVyRGF0YVRhYmxlKHRoaXMucGFyYW1zLCB0aGlzLmRhdGEpLnN1YnNjcmliZShkYXRhID0+IHtcblx0XHRcdFx0Y29uc3QgcmVzcG9uc2UgPSB0aGlzLnNlcnZpY2UuaGFuZGxlRGF0YShkYXRhPy5ib2R5KTtcblx0XHRcdFx0dGhpcy5zZXRDb3VudEFuZERhdGEocmVzcG9uc2UpO1xuXHRcdFx0XHR0aGlzLnNlbmREYXRhVG9UYWJsZSgpO1xuXHRcdFx0fSwoKSA9PiB7XG5cdFx0XHRcdHRoaXMucmVzZXREYXRhKCk7XG5cdFx0XHRcdHJldHVybiBvZigpO1xuXHRcdFx0fSk7XG5cdH1cblxuXHRwcml2YXRlIHNldENvdW50QW5kRGF0YShyZXNwb25zZTogU2lyZW5UYWJsZVNvdXJjZTxTaXJlblRhYmxlRGF0YT4pOiB2b2lkIHtcblx0XHR0aGlzLmNvdW50ID0gcmVzcG9uc2UuY291bnQ7XG5cdFx0dGhpcy5kYXRhID0gcmVzcG9uc2UubGlzdDtcblx0XHR0aGlzLmNoZWNrU2VsZWN0ZWRSb3dzKCk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgc2VuZERhdGFUb1RhYmxlKCk6IHZvaWQge1xuXHRcdHRoaXMuZGF0YVN1YmplY3QubmV4dCh0aGlzLmRhdGEpO1xuXHR9XG5cblx0cHVibGljIHNlbGVjdEFsbFJvd3MoKTogdm9pZCB7XG5cdFx0dGhpcy5kYXRhLmZvckVhY2gocm93ID0+IHtcblx0XHRcdHRoaXMuc2VsZWN0Um93KHJvdyk7XG5cdFx0fSk7XG5cdH1cblxuXHRwdWJsaWMgZGVzZWxlY3RBbGxSb3dzKG9ubHlQYWdpbmF0ZWQgPSB0cnVlKTogdm9pZCB7XG5cdFx0dGhpcy5kYXRhLmZvckVhY2gocm93ID0+IHRoaXMuZGVzZWxlY3RSb3cocm93KSlcblx0XHRpZiAoIW9ubHlQYWdpbmF0ZWQpIHtcblx0XHRcdHRoaXMuc2VsZWN0ZWRSb3dzLmNsZWFyKCk7XG5cdFx0fVxuXHR9XG5cdC8qKlxuXHQgKiBTZXRzIGN1cnJlbnQgcGFnZSwgc2l6ZSBhbmQgaW52b2tlIGZldGNoRGF0YSBhY2NvcmRpbmdseVxuXHQgKiBAcGFyYW0gZGF0YSBhIG1vZGVsIHRoYXQgY29udGFpbiBjdXJyZW50IHBhZ2UsIHNpemVcblx0ICovXG5cdHB1YmxpYyB1cGRhdGVQYWdpbmF0aW9uUGFyYW1zKGRhdGE6IFNpcmVuVGFibGVGaWx0ZXJNb2RlbCk6IHZvaWQge1xuXHRcdHRoaXMucGFyYW1zLnBhZ2UgPSBkYXRhLnBhZ2U7XG5cdFx0dGhpcy5wYXJhbXMuc2l6ZSA9IGRhdGEuc2l6ZTtcblx0XHR0aGlzLmZldGNoRGF0YSh0aGlzLnBhcmFtcyk7XG5cdH1cblx0LyoqXG5cdCAqIFNldHMgc29ydENvbHVtbiBhbmQgc29ydERpcmVjdGlvbiBhbmQgaW52b2tlIGZldGNoRGF0YSBhY2NvcmRpbmdseVxuXHQgKiBAcGFyYW0gZGF0YSBhIG1vZGVsIHRoYXQgY29udGFpbiBzb3J0Q29sdW1uIGFuZCBzb3J0RGlyZWN0aW9uXG5cdCAqL1xuXHRwdWJsaWMgdXBkYXRlU29ydFBhcmFtcyhkYXRhOiBTaXJlblRhYmxlRmlsdGVyTW9kZWwpOiB2b2lkIHtcblx0XHR0aGlzLnBhcmFtcy5zb3J0Q29sdW1uID0gZGF0YS5zb3J0Q29sdW1uO1xuXHRcdHRoaXMucGFyYW1zLnNvcnREaXJlY3Rpb24gPSBkYXRhLnNvcnREaXJlY3Rpb247XG5cdFx0dGhpcy5mZXRjaERhdGEodGhpcy5wYXJhbXMpO1xuXHR9XG59XG4iXX0=